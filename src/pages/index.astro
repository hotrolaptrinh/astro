---
import { getCollection } from "astro:content";
import Base from "../layouts/Base.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import Hero from "../components/Hero.astro";
import ProjectCard from "../components/ProjectCard.astro";
import Pagination from "../components/Pagination.astro";
import RequestForm from "../components/RequestForm.astro";
import Reviews from "../components/Reviews.astro";
import BackToTop from "../components/BackToTop.astro";
import { PROJECTS_PER_PAGE } from "../consts";
const allProjects = await getCollection("projects");
const projects = allProjects
  .filter(p => p.data.published)
  .sort((a,b) => b.data.date.getTime() - a.data.date.getTime());

// Static page 1; other pages rendered at /page/[page].astro
const totalPages = Math.max(1, Math.ceil(projects.length / PROJECTS_PER_PAGE));
const currentPage = 1;
const start = 0;
const pageItems = projects.slice(start, start + PROJECTS_PER_PAGE);
---
<Base title="Trang chủ">
  <Fragment slot="header"><Header /></Fragment>

  <Hero />

  <section id="projects" class="py-12 fade-in">
    <h2 class="text-2xl font-bold mb-6">Danh sách dự án</h2>
    <div class="grid gap-6 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
      {pageItems.map((p) => (
        <a href={`${Astro.site?.pathname}projects/${p.slug}`}><ProjectCard {...p.data} /></a>
      ))}
    </div>
    <Pagination page={currentPage} total={totalPages} usePath={true} basePath={Astro.site?.pathname || "/"} />
  </section>

  <RequestForm />
  <Reviews />

  <Fragment slot="footer">
    <BackToTop />
    <Footer />
  </Fragment>
</Base>
